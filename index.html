<<<<<<< HEAD
My Page
=======
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Yii2-ispconfig-api by mzdani</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-dark.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/mzdani/yii2-ispconfig-api">View On GitHub</a></li>
          <li class="downloads"><a href="https://github.com/mzdani/yii2-ispconfig-api/zipball/master">ZIP</a></li>
          <li class="downloads"><a href="https://github.com/mzdani/yii2-ispconfig-api/tarball/master">TAR</a></li>
          <li class="title">DOWNLOADS</li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>Yii2-ispconfig-api</h1>
          <p>Yii2 ISPConfig API Wrapper</p>
          <hr>
          <span class="credits left">Project maintained by <a href="https://github.com/mzdani">mzdani</a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></span>
        </div>

        <p><a href="https://packagist.org/packages/mzdani/yii2-ispconfig-api"><img src="https://poser.pugx.org/mzdani/yii2-ispconfig-api/v/stable.svg" alt="Latest Stable Version"></a> <a href="https://packagist.org/packages/mzdani/yii2-ispconfig-api"><img src="https://poser.pugx.org/mzdani/yii2-ispconfig-api/downloads.svg" alt="Total Downloads"></a> <a href="https://packagist.org/packages/mzdani/yii2-ispconfig-api"><img src="https://poser.pugx.org/mzdani/yii2-ispconfig-api/v/unstable.svg" alt="Latest Unstable Version"></a> <a href="https://packagist.org/packages/mzdani/yii2-ispconfig-api"><img src="https://poser.pugx.org/mzdani/yii2-ispconfig-api/license" alt="License"></a></p>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>The preferred way to install this extension is through <a href="http://getcomposer.org/download/">composer</a>.</p>

<p>Either run</p>

<pre><code>php composer.phar require --prefer-dist "mzdani/yii2-ispconfig-api" "dev-master"
</code></pre>

<p>or add</p>

<pre><code>"mzdani/yii2-ispconfig-api": "dev-master"
</code></pre>

<p>to the require section of your <code>composer.json</code> file.</p>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>Below is some example how to use the wrapper.</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-pse">&lt;?php</span><span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">mdscomp\ISPConfig\SoapClient</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$cp</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">SoapClient</span>(<span class="pl-s"><span class="pl-pds">'</span>http://your.cpdomain.tld:8080/remote/index.php<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>remoteusername<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>remoteuserpass<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">// Get Quota Status from Client</span></span>
<span class="pl-s1"><span class="pl-smi">$client_records</span> <span class="pl-k">=</span> <span class="pl-smi">$cp</span><span class="pl-k">-&gt;</span>clientGetQuota(<span class="pl-s"><span class="pl-pds">'</span>yourclientusername<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">print_r</span>(<span class="pl-smi">$client_records</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$cp</span><span class="pl-k">-&gt;</span>logout();</span>
<span class="pl-s1"></span>
<span class="pl-s1"></span><span class="pl-pse"><span class="pl-s1">?</span>&gt;</span></pre></div>

<p>Don't forget to <code>logoout()</code> after using, or your ISPConfig database remote session will full of "open session". And sometimes I get the wrong result because not <code>logout()</code> after get data.</p>

<h2>
<a id="ispconfig-custom-patch" class="anchor" href="#ispconfig-custom-patch" aria-hidden="true"><span class="octicon octicon-link"></span></a>ISPConfig Custom Patch</h2>

<p>Because ISPConfig doesn't have any support to show quota usage with remote api. I must add new function into default ISPConfig remote api file. You can find it from <code>/usr/local/ispconfig/interface/lib/classes/remoting.inc.php</code>, open it and insert new function below into at the end of class.</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-pse">&lt;?php</span><span class="pl-s1"></span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">/*******************</span></span>
<span class="pl-s1"><span class="pl-c">    * CUSTOM PATCH START</span></span>
<span class="pl-s1"><span class="pl-c">    *******************/</span></span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">client_get_quota</span>(<span class="pl-smi">$session_id</span>, <span class="pl-smi">$client_username</span>){</span>
<span class="pl-s1">        <span class="pl-k">global</span> <span class="pl-smi">$app</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-c">/*</span></span>
<span class="pl-s1"><span class="pl-c">        * Get Client Data</span></span>
<span class="pl-s1"><span class="pl-c">        */</span></span>
<span class="pl-s1">        <span class="pl-smi">$client_records</span> <span class="pl-k">=</span> <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span>client_get_by_username(<span class="pl-smi">$session_id</span>, <span class="pl-smi">$client_username</span>);</span>
<span class="pl-s1">        <span class="pl-smi">$client_data</span> <span class="pl-k">=</span> <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span>client_get(<span class="pl-smi">$session_id</span>, <span class="pl-smi">$client_records</span>[<span class="pl-s"><span class="pl-pds">'</span>client_id<span class="pl-pds">'</span></span>]);</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-c">/*</span></span>
<span class="pl-s1"><span class="pl-c">        * Website Harddisk Quota</span></span>
<span class="pl-s1"><span class="pl-c">        */</span></span>
<span class="pl-s1">        <span class="pl-smi">$tmp_site</span> <span class="pl-k">=</span>  <span class="pl-smi">$app</span><span class="pl-k">-&gt;</span><span class="pl-smi">db</span><span class="pl-k">-&gt;</span>queryAllRecords(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-k">SELECT</span> data <span class="pl-k">from</span> monitor_data <span class="pl-k">WHERE</span> type <span class="pl-k">=</span> <span class="pl-s">'harddisk_quota'</span> <span class="pl-k">ORDER BY</span> created <span class="pl-k">DESC</span></span><span class="pl-pds">"</span></span>);</span>
<span class="pl-s1">        <span class="pl-smi">$monitor_data_site</span> <span class="pl-k">=</span> <span class="pl-c1">array</span>();</span>
<span class="pl-s1">        <span class="pl-k">if</span>(<span class="pl-c1">is_array</span>(<span class="pl-smi">$tmp_site</span>)) {</span>
<span class="pl-s1">            <span class="pl-k">foreach</span> (<span class="pl-smi">$tmp_site</span> <span class="pl-k">as</span> <span class="pl-smi">$tmp_mon_site</span>) {</span>
<span class="pl-s1">                <span class="pl-smi">$monitor_data_site</span> <span class="pl-k">=</span> <span class="pl-c1">array_merge_recursive</span>(<span class="pl-smi">$monitor_data_site</span>, <span class="pl-c1">unserialize</span>(<span class="pl-smi">$app</span><span class="pl-k">-&gt;</span><span class="pl-smi">db</span><span class="pl-k">-&gt;</span>unquote(<span class="pl-smi">$tmp_mon_site</span>[<span class="pl-s"><span class="pl-pds">'</span>data<span class="pl-pds">'</span></span>])));</span>
<span class="pl-s1">            }</span>
<span class="pl-s1">        }</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-smi">$sites</span> <span class="pl-k">=</span> <span class="pl-smi">$app</span><span class="pl-k">-&gt;</span><span class="pl-smi">db</span><span class="pl-k">-&gt;</span>queryAllRecords(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-k">SELECT</span> <span class="pl-k">*</span> <span class="pl-k">FROM</span> web_domain <span class="pl-k">WHERE</span> active <span class="pl-k">=</span> <span class="pl-s">'y'</span> <span class="pl-k">AND</span> type <span class="pl-k">=</span> <span class="pl-s">'vhost'</span> <span class="pl-k">AND</span> sys_groupid <span class="pl-k">=</span> </span><span class="pl-pds">"</span></span><span class="pl-k">.</span><span class="pl-smi">$client_records</span>[<span class="pl-s"><span class="pl-pds">'</span>default_group<span class="pl-pds">'</span></span>]);</span>
<span class="pl-s1">        <span class="pl-smi">$has_quota</span> <span class="pl-k">=</span> <span class="pl-c1">false</span>;</span>
<span class="pl-s1">        <span class="pl-smi">$total_quota</span>[<span class="pl-s"><span class="pl-pds">'</span>limit_web_quota<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> (<span class="pl-smi">$client_data</span>[<span class="pl-s"><span class="pl-pds">'</span>limit_web_quota<span class="pl-pds">'</span></span>] <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>-1<span class="pl-pds">'</span></span>) ? <span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>lng(<span class="pl-s"><span class="pl-pds">'</span>unlimited<span class="pl-pds">'</span></span>) : <span class="pl-smi">$client_data</span>[<span class="pl-s"><span class="pl-pds">'</span>limit_web_quota<span class="pl-pds">'</span></span>]<span class="pl-k">*</span><span class="pl-c1">1048576</span>;</span>
<span class="pl-s1">        <span class="pl-smi">$total_quota</span>[<span class="pl-s"><span class="pl-pds">'</span>limit_traffic_quota<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> (<span class="pl-smi">$client_data</span>[<span class="pl-s"><span class="pl-pds">'</span>limit_traffic_quota<span class="pl-pds">'</span></span>] <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>-1<span class="pl-pds">'</span></span>) ? <span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>lng(<span class="pl-s"><span class="pl-pds">'</span>unlimited<span class="pl-pds">'</span></span>) : <span class="pl-smi">$client_data</span>[<span class="pl-s"><span class="pl-pds">'</span>limit_traffic_quota<span class="pl-pds">'</span></span>]<span class="pl-k">*</span><span class="pl-c1">1048576</span>;</span>
<span class="pl-s1">        <span class="pl-smi">$total_quota</span>[<span class="pl-s"><span class="pl-pds">'</span>limit_mailquota<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> (<span class="pl-smi">$client_data</span>[<span class="pl-s"><span class="pl-pds">'</span>limit_mailquota<span class="pl-pds">'</span></span>] <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>-1<span class="pl-pds">'</span></span>) ? <span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>lng(<span class="pl-s"><span class="pl-pds">'</span>unlimited<span class="pl-pds">'</span></span>) : <span class="pl-smi">$client_data</span>[<span class="pl-s"><span class="pl-pds">'</span>limit_mailquota<span class="pl-pds">'</span></span>]<span class="pl-k">*</span><span class="pl-c1">1048576</span>;</span>
<span class="pl-s1">        <span class="pl-smi">$web_quota</span> <span class="pl-k">=</span> [];</span>
<span class="pl-s1">        <span class="pl-k">if</span>(<span class="pl-c1">is_array</span>(<span class="pl-smi">$sites</span>) <span class="pl-k">&amp;&amp;</span> <span class="pl-k">!</span><span class="pl-c1">empty</span>(<span class="pl-smi">$sites</span>)){</span>
<span class="pl-s1">            <span class="pl-k">for</span>(<span class="pl-smi">$i</span><span class="pl-k">=</span><span class="pl-c1">0</span>;<span class="pl-smi">$i</span><span class="pl-k">&lt;</span><span class="pl-c1">sizeof</span>(<span class="pl-smi">$sites</span>);<span class="pl-smi">$i</span><span class="pl-k">++</span>){</span>
<span class="pl-s1">                <span class="pl-smi">$username</span> <span class="pl-k">=</span> <span class="pl-smi">$sites</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>system_user<span class="pl-pds">'</span></span>];</span>
<span class="pl-s1">                <span class="pl-smi">$web_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>domain<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-smi">$sites</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>domain<span class="pl-pds">'</span></span>];</span>
<span class="pl-s1">                <span class="pl-smi">$web_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>hd_quota<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> (<span class="pl-smi">$sites</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>hd_quota<span class="pl-pds">'</span></span>] <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>-1<span class="pl-pds">'</span></span>) ? <span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>lng(<span class="pl-s"><span class="pl-pds">'</span>unlimited<span class="pl-pds">'</span></span>) : <span class="pl-smi">$sites</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>hd_quota<span class="pl-pds">'</span></span>]<span class="pl-k">*</span><span class="pl-c1">1048576</span>;</span>
<span class="pl-s1">                <span class="pl-smi">$web_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>traffic_quota<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> (<span class="pl-smi">$sites</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>traffic_quota<span class="pl-pds">'</span></span>] <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>-1<span class="pl-pds">'</span></span>) ? <span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>lng(<span class="pl-s"><span class="pl-pds">'</span>unlimited<span class="pl-pds">'</span></span>) : <span class="pl-smi">$sites</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>traffic_quota<span class="pl-pds">'</span></span>]<span class="pl-k">*</span><span class="pl-c1">1048576</span>;</span>
<span class="pl-s1">                <span class="pl-smi">$web_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>used<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-smi">$monitor_data_site</span>[<span class="pl-s"><span class="pl-pds">'</span>user<span class="pl-pds">'</span></span>][<span class="pl-smi">$username</span>][<span class="pl-s"><span class="pl-pds">'</span>used<span class="pl-pds">'</span></span>]<span class="pl-k">*</span><span class="pl-c1">1024</span>;</span>
<span class="pl-s1">                <span class="pl-smi">$web_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>soft<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-smi">$monitor_data_site</span>[<span class="pl-s"><span class="pl-pds">'</span>user<span class="pl-pds">'</span></span>][<span class="pl-smi">$username</span>][<span class="pl-s"><span class="pl-pds">'</span>soft<span class="pl-pds">'</span></span>]<span class="pl-k">*</span><span class="pl-c1">1024</span>;</span>
<span class="pl-s1">                <span class="pl-smi">$web_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>hard<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-smi">$monitor_data_site</span>[<span class="pl-s"><span class="pl-pds">'</span>user<span class="pl-pds">'</span></span>][<span class="pl-smi">$username</span>][<span class="pl-s"><span class="pl-pds">'</span>hard<span class="pl-pds">'</span></span>]<span class="pl-k">*</span><span class="pl-c1">1024</span>;</span>
<span class="pl-s1">                <span class="pl-smi">$web_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>files<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-smi">$monitor_data_site</span>[<span class="pl-s"><span class="pl-pds">'</span>user<span class="pl-pds">'</span></span>][<span class="pl-smi">$username</span>][<span class="pl-s"><span class="pl-pds">'</span>files<span class="pl-pds">'</span></span>];</span>
<span class="pl-s1"></span>
<span class="pl-s1">                <span class="pl-k">if</span> (<span class="pl-k">!</span><span class="pl-c1">is_numeric</span>(<span class="pl-smi">$web_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>used<span class="pl-pds">'</span></span>])){</span>
<span class="pl-s1">                    <span class="pl-k">if</span> (<span class="pl-smi">$web_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>used<span class="pl-pds">'</span></span>][<span class="pl-c1">0</span>] <span class="pl-k">&gt;</span> <span class="pl-smi">$web_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>used<span class="pl-pds">'</span></span>][<span class="pl-c1">1</span>]){</span>
<span class="pl-s1">                        <span class="pl-smi">$web_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>used<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-smi">$web_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>used<span class="pl-pds">'</span></span>][<span class="pl-c1">0</span>];</span>
<span class="pl-s1">                    } <span class="pl-k">else</span> {</span>
<span class="pl-s1">                        <span class="pl-smi">$web_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>used<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-smi">$web_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>used<span class="pl-pds">'</span></span>][<span class="pl-c1">1</span>];</span>
<span class="pl-s1">                    }</span>
<span class="pl-s1">                }</span>
<span class="pl-s1">                <span class="pl-k">if</span> (<span class="pl-k">!</span><span class="pl-c1">is_numeric</span>(<span class="pl-smi">$web_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>soft<span class="pl-pds">'</span></span>])) <span class="pl-smi">$web_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>soft<span class="pl-pds">'</span></span>]<span class="pl-k">=</span><span class="pl-smi">$web_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>soft<span class="pl-pds">'</span></span>][<span class="pl-c1">1</span>];</span>
<span class="pl-s1">                <span class="pl-k">if</span> (<span class="pl-k">!</span><span class="pl-c1">is_numeric</span>(<span class="pl-smi">$web_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>hard<span class="pl-pds">'</span></span>])) <span class="pl-smi">$web_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>hard<span class="pl-pds">'</span></span>]<span class="pl-k">=</span><span class="pl-smi">$web_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>hard<span class="pl-pds">'</span></span>][<span class="pl-c1">1</span>];</span>
<span class="pl-s1">                <span class="pl-k">if</span> (<span class="pl-k">!</span><span class="pl-c1">is_numeric</span>(<span class="pl-smi">$web_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>files<span class="pl-pds">'</span></span>])) <span class="pl-smi">$web_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>files<span class="pl-pds">'</span></span>]<span class="pl-k">=</span><span class="pl-smi">$web_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>files<span class="pl-pds">'</span></span>][<span class="pl-c1">1</span>];           </span>
<span class="pl-s1"></span>
<span class="pl-s1">                <span class="pl-k">if</span>(<span class="pl-smi">$web_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>soft<span class="pl-pds">'</span></span>] <span class="pl-k">==</span> <span class="pl-c1">0</span>) <span class="pl-smi">$web_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>soft<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>lng(<span class="pl-s"><span class="pl-pds">'</span>unlimited<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">                <span class="pl-k">if</span>(<span class="pl-smi">$web_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>hard<span class="pl-pds">'</span></span>] <span class="pl-k">==</span> <span class="pl-c1">0</span>) <span class="pl-smi">$web_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>hard<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>lng(<span class="pl-s"><span class="pl-pds">'</span>unlimited<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">                <span class="pl-k">if</span>(<span class="pl-smi">$web_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>soft<span class="pl-pds">'</span></span>] <span class="pl-k">==</span> <span class="pl-c1">0</span> <span class="pl-k">||</span> <span class="pl-smi">$web_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>soft<span class="pl-pds">'</span></span>] <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>0<span class="pl-pds">'</span></span>) <span class="pl-smi">$web_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>soft<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>lng(<span class="pl-s"><span class="pl-pds">'</span>unlimited<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">                <span class="pl-k">if</span>(<span class="pl-smi">$web_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>hard<span class="pl-pds">'</span></span>] <span class="pl-k">==</span> <span class="pl-c1">0</span> <span class="pl-k">||</span> <span class="pl-smi">$web_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>hard<span class="pl-pds">'</span></span>] <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>0<span class="pl-pds">'</span></span>) <span class="pl-smi">$web_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>hard<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>lng(<span class="pl-s"><span class="pl-pds">'</span>unlimited<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">                <span class="pl-c">/*</span></span>
<span class="pl-s1"><span class="pl-c">                * Website Traffic Statistic</span></span>
<span class="pl-s1"><span class="pl-c">                */</span></span>
<span class="pl-s1"></span>
<span class="pl-s1">                <span class="pl-c">//** Traffic of the current month</span></span>
<span class="pl-s1">                <span class="pl-smi">$tmp_year</span> <span class="pl-k">=</span> <span class="pl-c1">date</span>(<span class="pl-s"><span class="pl-pds">'</span>Y<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">                <span class="pl-smi">$tmp_month</span> <span class="pl-k">=</span> <span class="pl-c1">date</span>(<span class="pl-s"><span class="pl-pds">'</span>m<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">                <span class="pl-smi">$tmp_rec</span> <span class="pl-k">=</span> <span class="pl-smi">$app</span><span class="pl-k">-&gt;</span><span class="pl-smi">db</span><span class="pl-k">-&gt;</span>queryOneRecord(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-k">SELECT</span> <span class="pl-c1">SUM</span>(traffic_bytes) <span class="pl-k">as</span> t <span class="pl-k">FROM</span> web_traffic <span class="pl-k">WHERE</span> hostname <span class="pl-k">=</span> <span class="pl-s">'</span></span><span class="pl-pds">"</span></span><span class="pl-k">.</span><span class="pl-smi">$app</span><span class="pl-k">-&gt;</span><span class="pl-smi">db</span><span class="pl-k">-&gt;</span>quote(<span class="pl-smi">$sites</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>domain<span class="pl-pds">'</span></span>])<span class="pl-k">.</span><span class="pl-s"><span class="pl-pds">"</span>' AND YEAR(traffic_date) = '<span class="pl-smi">$tmp_year</span>' AND MONTH(traffic_date) = '<span class="pl-smi">$tmp_month</span>'<span class="pl-pds">"</span></span>);</span>
<span class="pl-s1">                <span class="pl-smi">$web_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>traffic<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>this_month<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-c1">number_format</span>(<span class="pl-smi">$tmp_rec</span>[<span class="pl-s"><span class="pl-pds">'</span>t<span class="pl-pds">'</span></span>], <span class="pl-c1">0</span>, <span class="pl-s"><span class="pl-pds">'</span>.<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">                <span class="pl-c">//** Traffic of the last month</span></span>
<span class="pl-s1">                <span class="pl-smi">$tmp_year</span> <span class="pl-k">=</span> <span class="pl-c1">date</span>(<span class="pl-s"><span class="pl-pds">'</span>Y<span class="pl-pds">'</span></span>, <span class="pl-c1">mktime</span>(<span class="pl-c1">0</span>, <span class="pl-c1">0</span>, <span class="pl-c1">0</span>, <span class="pl-c1">date</span>(<span class="pl-s"><span class="pl-pds">"</span>m<span class="pl-pds">"</span></span>)<span class="pl-k">-</span><span class="pl-c1">1</span>, <span class="pl-c1">date</span>(<span class="pl-s"><span class="pl-pds">"</span>d<span class="pl-pds">"</span></span>), <span class="pl-c1">date</span>(<span class="pl-s"><span class="pl-pds">"</span>Y<span class="pl-pds">"</span></span>)));</span>
<span class="pl-s1">                <span class="pl-smi">$tmp_month</span> <span class="pl-k">=</span> <span class="pl-c1">date</span>(<span class="pl-s"><span class="pl-pds">'</span>m<span class="pl-pds">'</span></span>, <span class="pl-c1">mktime</span>(<span class="pl-c1">0</span>, <span class="pl-c1">0</span>, <span class="pl-c1">0</span>, <span class="pl-c1">date</span>(<span class="pl-s"><span class="pl-pds">"</span>m<span class="pl-pds">"</span></span>)<span class="pl-k">-</span><span class="pl-c1">1</span>, <span class="pl-c1">date</span>(<span class="pl-s"><span class="pl-pds">"</span>d<span class="pl-pds">"</span></span>), <span class="pl-c1">date</span>(<span class="pl-s"><span class="pl-pds">"</span>Y<span class="pl-pds">"</span></span>)));</span>
<span class="pl-s1">                <span class="pl-smi">$tmp_rec</span> <span class="pl-k">=</span> <span class="pl-smi">$app</span><span class="pl-k">-&gt;</span><span class="pl-smi">db</span><span class="pl-k">-&gt;</span>queryOneRecord(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-k">SELECT</span> <span class="pl-c1">sum</span>(traffic_bytes) <span class="pl-k">as</span> t <span class="pl-k">FROM</span> web_traffic <span class="pl-k">WHERE</span> hostname <span class="pl-k">=</span> <span class="pl-s">'</span></span><span class="pl-pds">"</span></span><span class="pl-k">.</span><span class="pl-smi">$app</span><span class="pl-k">-&gt;</span><span class="pl-smi">db</span><span class="pl-k">-&gt;</span>quote(<span class="pl-smi">$sites</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>domain<span class="pl-pds">'</span></span>])<span class="pl-k">.</span><span class="pl-s"><span class="pl-pds">"</span>' AND YEAR(traffic_date) = '<span class="pl-smi">$tmp_year</span>' AND MONTH(traffic_date) = '<span class="pl-smi">$tmp_month</span>'<span class="pl-pds">"</span></span>);</span>
<span class="pl-s1">                <span class="pl-smi">$web_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>traffic<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>last_month<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-c1">number_format</span>(<span class="pl-smi">$tmp_rec</span>[<span class="pl-s"><span class="pl-pds">'</span>t<span class="pl-pds">'</span></span>]<span class="pl-k">*</span><span class="pl-c1">1024</span>, <span class="pl-c1">0</span>, <span class="pl-s"><span class="pl-pds">'</span>.<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">            }</span>
<span class="pl-s1">            <span class="pl-smi">$has_quota</span> <span class="pl-k">=</span> <span class="pl-c1">true</span>;</span>
<span class="pl-s1">        }</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-c">/*</span></span>
<span class="pl-s1"><span class="pl-c">        * Email Quota</span></span>
<span class="pl-s1"><span class="pl-c">        */</span></span>
<span class="pl-s1">        <span class="pl-smi">$tmp_mails</span> <span class="pl-k">=</span>  <span class="pl-smi">$app</span><span class="pl-k">-&gt;</span><span class="pl-smi">db</span><span class="pl-k">-&gt;</span>queryAllRecords(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-k">SELECT</span> data <span class="pl-k">from</span> monitor_data <span class="pl-k">WHERE</span> type <span class="pl-k">=</span> <span class="pl-s">'email_quota'</span> <span class="pl-k">ORDER BY</span> created <span class="pl-k">DESC</span></span><span class="pl-pds">"</span></span>);</span>
<span class="pl-s1">        <span class="pl-smi">$monitor_data_mails</span> <span class="pl-k">=</span> <span class="pl-c1">array</span>();</span>
<span class="pl-s1">        <span class="pl-k">if</span>(<span class="pl-c1">is_array</span>(<span class="pl-smi">$tmp_mails</span>)) {</span>
<span class="pl-s1">            <span class="pl-k">foreach</span> (<span class="pl-smi">$tmp_mails</span> <span class="pl-k">as</span> <span class="pl-smi">$tmp_mon_mails</span>) {</span>
<span class="pl-s1">                <span class="pl-smi">$tmp_array</span> <span class="pl-k">=</span> <span class="pl-c1">unserialize</span>(<span class="pl-smi">$app</span><span class="pl-k">-&gt;</span><span class="pl-smi">db</span><span class="pl-k">-&gt;</span>unquote(<span class="pl-smi">$tmp_mon_mails</span>[<span class="pl-s"><span class="pl-pds">'</span>data<span class="pl-pds">'</span></span>]));</span>
<span class="pl-s1">                <span class="pl-k">if</span>(<span class="pl-c1">is_array</span>(<span class="pl-smi">$tmp_array</span>)) {</span>
<span class="pl-s1">                    <span class="pl-k">foreach</span>(<span class="pl-smi">$tmp_array</span> <span class="pl-k">as</span> <span class="pl-smi">$username</span> <span class="pl-k">=&gt;</span> <span class="pl-smi">$data</span>) {</span>
<span class="pl-s1">                        <span class="pl-k">if</span>(<span class="pl-k">!</span><span class="pl-smi">$monitor_data_mails</span>[<span class="pl-smi">$username</span>][<span class="pl-s"><span class="pl-pds">'</span>used<span class="pl-pds">'</span></span>]) <span class="pl-smi">$monitor_data_mails</span>[<span class="pl-smi">$username</span>][<span class="pl-s"><span class="pl-pds">'</span>used<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-smi">$data</span>[<span class="pl-s"><span class="pl-pds">'</span>used<span class="pl-pds">'</span></span>];</span>
<span class="pl-s1">                    }</span>
<span class="pl-s1">                }</span>
<span class="pl-s1">            }</span>
<span class="pl-s1">        }</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-smi">$emails</span> <span class="pl-k">=</span> <span class="pl-smi">$app</span><span class="pl-k">-&gt;</span><span class="pl-smi">db</span><span class="pl-k">-&gt;</span>queryAllRecords(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-s1"><span class="pl-k">SELECT</span> <span class="pl-k">*</span> <span class="pl-k">FROM</span> mail_user <span class="pl-k">WHERE</span> <span class="pl-c1">1</span> <span class="pl-k">AND</span> sys_groupid <span class="pl-k">=</span> </span><span class="pl-pds">"</span></span><span class="pl-k">.</span><span class="pl-smi">$client_records</span>[<span class="pl-s"><span class="pl-pds">'</span>default_group<span class="pl-pds">'</span></span>]);</span>
<span class="pl-s1">        <span class="pl-smi">$has_mailquota</span> <span class="pl-k">=</span> <span class="pl-c1">false</span>;</span>
<span class="pl-s1">        <span class="pl-smi">$mails_quota</span> <span class="pl-k">=</span> [];</span>
<span class="pl-s1">        <span class="pl-k">if</span>(<span class="pl-c1">is_array</span>(<span class="pl-smi">$emails</span>) <span class="pl-k">&amp;&amp;</span> <span class="pl-k">!</span><span class="pl-c1">empty</span>(<span class="pl-smi">$emails</span>)){</span>
<span class="pl-s1">            <span class="pl-k">for</span>(<span class="pl-smi">$i</span><span class="pl-k">=</span><span class="pl-c1">0</span>;<span class="pl-smi">$i</span><span class="pl-k">&lt;</span><span class="pl-c1">sizeof</span>(<span class="pl-smi">$emails</span>);<span class="pl-smi">$i</span><span class="pl-k">++</span>){</span>
<span class="pl-s1">                <span class="pl-smi">$email</span> <span class="pl-k">=</span> <span class="pl-smi">$emails</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>email<span class="pl-pds">'</span></span>];</span>
<span class="pl-s1"></span>
<span class="pl-s1">                <span class="pl-smi">$mails_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>email<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-smi">$emails</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>email<span class="pl-pds">'</span></span>];</span>
<span class="pl-s1">                <span class="pl-smi">$mails_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>used<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-c1">isset</span>(<span class="pl-smi">$monitor_data_mails</span>[<span class="pl-smi">$email</span>][<span class="pl-s"><span class="pl-pds">'</span>used<span class="pl-pds">'</span></span>]) ? <span class="pl-smi">$monitor_data_mails</span>[<span class="pl-smi">$email</span>][<span class="pl-s"><span class="pl-pds">'</span>used<span class="pl-pds">'</span></span>] : <span class="pl-c1">array</span>(<span class="pl-c1">1</span> <span class="pl-k">=&gt;</span> <span class="pl-c1">0</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">                <span class="pl-k">if</span> (<span class="pl-k">!</span><span class="pl-c1">is_numeric</span>(<span class="pl-smi">$mails_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>used<span class="pl-pds">'</span></span>])) <span class="pl-smi">$mails_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>used<span class="pl-pds">'</span></span>]<span class="pl-k">=</span><span class="pl-smi">$mails_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>used<span class="pl-pds">'</span></span>][<span class="pl-c1">1</span>];</span>
<span class="pl-s1"></span>
<span class="pl-s1">                <span class="pl-k">if</span>(<span class="pl-smi">$mails_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>quota<span class="pl-pds">'</span></span>] <span class="pl-k">==</span> <span class="pl-c1">0</span>){</span>
<span class="pl-s1">                    <span class="pl-smi">$mails_quota</span>[<span class="pl-smi">$i</span>][<span class="pl-s"><span class="pl-pds">'</span>quota<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-smi">$app</span><span class="pl-k">-&gt;</span>lng(<span class="pl-s"><span class="pl-pds">'</span>unlimited<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">                }</span>
<span class="pl-s1">            }</span>
<span class="pl-s1">            <span class="pl-smi">$has_mailquota</span> <span class="pl-k">=</span> <span class="pl-c1">true</span>;</span>
<span class="pl-s1">        }</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-c">/*</span></span>
<span class="pl-s1"><span class="pl-c">        * Returning Data</span></span>
<span class="pl-s1"><span class="pl-c">        */</span></span>
<span class="pl-s1">        <span class="pl-smi">$return</span> <span class="pl-k">=</span> [</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>limit<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-smi">$total_quota</span>,</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>used<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [</span>
<span class="pl-s1">                <span class="pl-s"><span class="pl-pds">'</span>site<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> (<span class="pl-smi">$has_quota</span>) ? <span class="pl-smi">$web_quota</span> : <span class="pl-c1">false</span>,</span>
<span class="pl-s1">                <span class="pl-s"><span class="pl-pds">'</span>mail<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> (<span class="pl-smi">$has_mailquota</span>) ? <span class="pl-smi">$mails_quota</span> : <span class="pl-c1">false</span>,</span>
<span class="pl-s1">            ],</span>
<span class="pl-s1">        ];</span>
<span class="pl-s1">        <span class="pl-k">return</span> <span class="pl-smi">$return</span>;</span>
<span class="pl-s1">    }</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">/*****************</span></span>
<span class="pl-s1"><span class="pl-c">    * CUSTOM PATCH END</span></span>
<span class="pl-s1"><span class="pl-c">    *****************/</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"></span><span class="pl-pse"><span class="pl-s1">?</span>&gt;</span></pre></div>

<p>After adding those function. Here is some example using the new function.</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-pse">&lt;?php</span><span class="pl-s1"></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c"> * Get Status ISPConfig Panel</span></span>
<span class="pl-s1"><span class="pl-c"> */</span></span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">mdscomp\ISPConfig\SoapClient</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$cp</span>                                  <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">SoapClient</span>(<span class="pl-s"><span class="pl-pds">'</span>http://your.cpdomain.tld:8080/remote/index.php<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>remoteusername<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>remoteuserpasswd<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$data</span>                                <span class="pl-k">=</span> <span class="pl-smi">$cp</span><span class="pl-k">-&gt;</span>clientGetQuota(<span class="pl-s"><span class="pl-pds">'</span>clientusername<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$max_quota_hdd</span>     <span class="pl-k">=</span> <span class="pl-smi">$data</span>[<span class="pl-s"><span class="pl-pds">'</span>limit<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>limit_web_quota<span class="pl-pds">'</span></span>];</span>
<span class="pl-s1"><span class="pl-smi">$max_quota_traffic</span> <span class="pl-k">=</span> <span class="pl-smi">$data</span>[<span class="pl-s"><span class="pl-pds">'</span>limit<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>limit_traffic_quota<span class="pl-pds">'</span></span>];</span>
<span class="pl-s1"><span class="pl-smi">$max_quota_mail</span>    <span class="pl-k">=</span> <span class="pl-smi">$data</span>[<span class="pl-s"><span class="pl-pds">'</span>limit<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>limit_mailquota<span class="pl-pds">'</span></span>];</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$used_quota_hdd</span> <span class="pl-k">=</span> <span class="pl-c1">0</span>;</span>
<span class="pl-s1"><span class="pl-smi">$used_quota_traffic</span> <span class="pl-k">=</span> <span class="pl-c1">0</span>;</span>
<span class="pl-s1"><span class="pl-k">foreach</span> (<span class="pl-smi">$data</span>[<span class="pl-s"><span class="pl-pds">'</span>used<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>site<span class="pl-pds">'</span></span>] <span class="pl-k">as</span> <span class="pl-smi">$key</span> <span class="pl-k">=&gt;</span> <span class="pl-smi">$value</span>) {</span>
<span class="pl-s1">    <span class="pl-smi">$used_quota_hdd</span> <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-smi">$value</span>[<span class="pl-s"><span class="pl-pds">'</span>used<span class="pl-pds">'</span></span>];</span>
<span class="pl-s1">    <span class="pl-smi">$used_quota_traffic</span> <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-smi">$value</span>[<span class="pl-s"><span class="pl-pds">'</span>traffic<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>this_month<span class="pl-pds">'</span></span>];</span>
<span class="pl-s1">}</span>
<span class="pl-s1"><span class="pl-c1">Yii</span><span class="pl-k">::</span><span class="pl-smi">$app</span><span class="pl-k">-&gt;</span><span class="pl-smi">formatter</span><span class="pl-k">-&gt;</span><span class="pl-smi">sizeFormatBase</span> <span class="pl-k">=</span> <span class="pl-c1">1000</span>;</span>
<span class="pl-s1"><span class="pl-smi">$tpl</span>[] <span class="pl-k">=</span> [</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>item<span class="pl-pds">'</span></span>    <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>Disk Space Usage<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>used<span class="pl-pds">'</span></span>    <span class="pl-k">=&gt;</span> <span class="pl-c1">Yii</span><span class="pl-k">::</span><span class="pl-smi">$app</span><span class="pl-k">-&gt;</span><span class="pl-smi">formatter</span><span class="pl-k">-&gt;</span>asShortSize(<span class="pl-smi">$used_quota_hdd</span>, <span class="pl-c1">2</span>),</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>max<span class="pl-pds">'</span></span>     <span class="pl-k">=&gt;</span> (<span class="pl-smi">$max_quota_hdd</span> <span class="pl-k">!</span><span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>unlimited<span class="pl-pds">'</span></span>) ? <span class="pl-c1">Yii</span><span class="pl-k">::</span><span class="pl-smi">$app</span><span class="pl-k">-&gt;</span><span class="pl-smi">formatter</span><span class="pl-k">-&gt;</span>asShortSize(<span class="pl-smi">$max_quota_hdd</span>, <span class="pl-c1">2</span>) : <span class="pl-smi">$max_quota_hdd</span>,</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>percent<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> (<span class="pl-smi">$max_quota_hdd</span> <span class="pl-k">!</span><span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>unlimited<span class="pl-pds">'</span></span>) ? <span class="pl-c1">round</span>(((<span class="pl-smi">$used_quota_hdd</span><span class="pl-k">/</span><span class="pl-smi">$max_quota_hdd</span>) <span class="pl-k">*</span> <span class="pl-c1">100</span>), <span class="pl-c1">2</span>) : <span class="pl-c1">0</span>,</span>
<span class="pl-s1">];</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">Yii</span><span class="pl-k">::</span><span class="pl-smi">$app</span><span class="pl-k">-&gt;</span><span class="pl-smi">formatter</span><span class="pl-k">-&gt;</span><span class="pl-smi">sizeFormatBase</span> <span class="pl-k">=</span> <span class="pl-c1">1024</span>;</span>
<span class="pl-s1"><span class="pl-smi">$tpl</span>[] <span class="pl-k">=</span> [</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>item<span class="pl-pds">'</span></span>    <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>Traffic Usage<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>used<span class="pl-pds">'</span></span>    <span class="pl-k">=&gt;</span> <span class="pl-c1">Yii</span><span class="pl-k">::</span><span class="pl-smi">$app</span><span class="pl-k">-&gt;</span><span class="pl-smi">formatter</span><span class="pl-k">-&gt;</span>asShortSize(<span class="pl-smi">$used_quota_traffic</span>, <span class="pl-c1">2</span>),</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>max<span class="pl-pds">'</span></span>     <span class="pl-k">=&gt;</span> (<span class="pl-smi">$max_quota_traffic</span> <span class="pl-k">!</span><span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>unlimited<span class="pl-pds">'</span></span>) ? <span class="pl-c1">Yii</span><span class="pl-k">::</span><span class="pl-smi">$app</span><span class="pl-k">-&gt;</span><span class="pl-smi">formatter</span><span class="pl-k">-&gt;</span>asShortSize(<span class="pl-smi">$max_quota_traffic</span>, <span class="pl-c1">2</span>) : <span class="pl-smi">$max_quota_traffic</span>,</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>percent<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> (<span class="pl-smi">$max_quota_traffic</span> <span class="pl-k">!</span><span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>unlimited<span class="pl-pds">'</span></span>) ? <span class="pl-c1">round</span>(((<span class="pl-smi">$used_quota_traffic</span><span class="pl-k">/</span><span class="pl-smi">$max_quota_traffic</span>) <span class="pl-k">*</span> <span class="pl-c1">100</span>), <span class="pl-c1">2</span>) : <span class="pl-c1">0</span>,</span>
<span class="pl-s1">];</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">Yii</span><span class="pl-k">::</span><span class="pl-smi">$app</span><span class="pl-k">-&gt;</span><span class="pl-smi">formatter</span><span class="pl-k">-&gt;</span><span class="pl-smi">sizeFormatBase</span> <span class="pl-k">=</span> <span class="pl-c1">1000</span>;</span>
<span class="pl-s1"><span class="pl-smi">$used_quota_mail</span> <span class="pl-k">=</span> <span class="pl-c1">0</span>;</span>
<span class="pl-s1"><span class="pl-k">if</span> (<span class="pl-c1">isset</span>(<span class="pl-smi">$data</span>[<span class="pl-s"><span class="pl-pds">'</span>used<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>mail<span class="pl-pds">'</span></span>]) <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">is_array</span>(<span class="pl-smi">$data</span>[<span class="pl-s"><span class="pl-pds">'</span>used<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>mail<span class="pl-pds">'</span></span>])) {</span>
<span class="pl-s1">    <span class="pl-k">foreach</span> (<span class="pl-smi">$data</span>[<span class="pl-s"><span class="pl-pds">'</span>used<span class="pl-pds">'</span></span>][<span class="pl-s"><span class="pl-pds">'</span>mail<span class="pl-pds">'</span></span>] <span class="pl-k">as</span> <span class="pl-smi">$key</span> <span class="pl-k">=&gt;</span> <span class="pl-smi">$value</span>) {</span>
<span class="pl-s1">        <span class="pl-smi">$used_quota_mail</span> <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-smi">$value</span>[<span class="pl-s"><span class="pl-pds">'</span>used<span class="pl-pds">'</span></span>];</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">    <span class="pl-smi">$tpl</span>[] <span class="pl-k">=</span> [</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>item<span class="pl-pds">'</span></span>    <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>Email Space Usage<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>used<span class="pl-pds">'</span></span>    <span class="pl-k">=&gt;</span> <span class="pl-c1">Yii</span><span class="pl-k">::</span><span class="pl-smi">$app</span><span class="pl-k">-&gt;</span><span class="pl-smi">formatter</span><span class="pl-k">-&gt;</span>asShortSize(<span class="pl-smi">$used_quota_mail</span>, <span class="pl-c1">2</span>),</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>max<span class="pl-pds">'</span></span>     <span class="pl-k">=&gt;</span> (<span class="pl-smi">$max_quota_hdd</span> <span class="pl-k">!</span><span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>unlimited<span class="pl-pds">'</span></span>) ? <span class="pl-c1">Yii</span><span class="pl-k">::</span><span class="pl-smi">$app</span><span class="pl-k">-&gt;</span><span class="pl-smi">formatter</span><span class="pl-k">-&gt;</span>asShortSize(<span class="pl-smi">$max_quota_mail</span>, <span class="pl-c1">2</span>) : <span class="pl-smi">$max_quota_mail</span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>percent<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> (<span class="pl-smi">$max_quota_hdd</span> <span class="pl-k">!</span><span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>unlimited<span class="pl-pds">'</span></span>) ? <span class="pl-c1">round</span>(((<span class="pl-smi">$used_quota_mail</span><span class="pl-k">/</span><span class="pl-smi">$max_quota_mail</span>) <span class="pl-k">*</span> <span class="pl-c1">100</span>), <span class="pl-c1">2</span>) : <span class="pl-c1">0</span>,</span>
<span class="pl-s1">    ];</span>
<span class="pl-s1">}</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$cp</span><span class="pl-k">-&gt;</span>logout();</span>
<span class="pl-s1"></span>
<span class="pl-s1"></span><span class="pl-pse"><span class="pl-s1">?</span>&gt;</span></pre></div>

<p>and after some theming, here is the result.</p>

<p><img src="https://bitbucket.org/repo/76XnzK/images/2480093029-Screenshot_507.jpg" alt="Screenshot_507.jpg">
<img src="https://bitbucket.org/repo/76XnzK/images/884887269-Screenshot_508.jpg" alt="Screenshot_508.jpg">
<img src="https://bitbucket.org/repo/76XnzK/images/1760568156-Screenshot_509.jpg" alt="Screenshot_509.jpg">
<img src="https://bitbucket.org/repo/76XnzK/images/2286964774-Screenshot_510.jpg" alt="Screenshot_510.jpg"></p>

<p>Sorry for my bad english and code. Have fun!</p>
      </section>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>
>>>>>>> d92f8282919c4db6ab7a17dcd4af7ab7b4ecd68f
